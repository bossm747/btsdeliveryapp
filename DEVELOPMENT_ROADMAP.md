# BTS Delivery App - Multi-Vendor Platform Development Roadmap

**Generated by Expert Development Team Analysis**
**Date:** January 17, 2025

---

## Executive Summary

The BTS Delivery app has a **solid 65% complete foundation** with enterprise-grade database schema (66+ tables), 230+ API endpoints, and comprehensive security middleware. However, critical gaps exist that must be addressed before it can compete with platforms like Enatega, Talabat, FoodPanda, and UberEats.

### Current Implementation Score by Area

| Area | Score | Status |
|------|-------|--------|
| Database Schema | 90% | Excellent foundation |
| API Routes | 85% | 230 endpoints implemented |
| Pricing Engine | 95% | Advanced dynamic pricing |
| Order Lifecycle | 70% | Missing cancellation/refund flows |
| Payment Processing | 75% | NexusPay integrated, missing wallet |
| Vendor Onboarding | 30% | Schema exists, zero workflows |
| Commission/Payouts | 50% | Schema complete, missing APIs |
| Real-time Features | 60% | WebSocket partial, needs completion |
| Admin Panel | 40% | Basic UI, missing critical features |
| Frontend UX | 60% | Core flows work, missing polish |

**Overall Readiness: 65% - MVP foundation ready, needs 6-8 weeks for production launch**

---

## Phase 1: Critical Launch Blockers (Weeks 1-2)

### 1.1 Vendor Onboarding & KYC System

**Status:** CRITICAL - Currently no workflow exists

**Backend Tasks:**
- Create `vendor_kyc_documents` table (license, permits, tax ID, bank details)
- Create `vendor_bank_accounts` table for payout destinations
- Implement multi-step onboarding API:
  - `POST /api/vendor/register` - Initial registration
  - `POST /api/vendor/kyc/upload-documents` - Document upload
  - `POST /api/vendor/kyc/verify-bank-account` - Bank verification
  - `GET /api/vendor/kyc/status` - Check approval status
  - `POST /api/admin/vendor/{id}/approve` - Admin approval
  - `POST /api/admin/vendor/{id}/reject` - Admin rejection

**Frontend Tasks:**
- Vendor registration wizard (multi-step form)
- Document upload with preview
- Admin vendor approval dashboard
- Verification status badges

**Effort:** 40 hours

---

### 1.2 Order Refund Workflow

**Status:** CRITICAL - Manual process currently

**Backend Tasks:**
- Implement automatic refund on order cancellation
- Create refund calculation logic:
  ```
  Before vendor accepts → 100% refund
  After vendor accepts → 80% refund
  After pickup → 50% refund
  After delivery → Dispute required
  ```
- Endpoints:
  - `POST /api/orders/{id}/cancel` - Customer cancellation
  - `GET /api/orders/{id}/refund-eligibility` - Check refund amount
  - `PATCH /api/admin/refunds/{id}/process` - Admin processing

**Frontend Tasks:**
- Cancellation flow with refund preview
- Refund status tracking UI
- Admin refund management dashboard

**Effort:** 30 hours

---

### 1.3 Rider Verification System

**Status:** CRITICAL - Boolean flag only exists

**Backend Tasks:**
- Create `rider_documents` table (ID, license, vehicle registration, insurance)
- Create `rider_verification_status` table with checklist
- Implement verification workflow:
  - `POST /api/rider/documents/upload` - Document upload
  - `GET /api/rider/verification/status` - Check status
  - `POST /api/admin/riders/{id}/verify-document` - Admin verification
  - `POST /api/admin/riders/{id}/complete-verification` - Final approval

**Frontend Tasks:**
- Rider document upload screens
- Admin verification dashboard with document preview
- Verification progress indicator

**Effort:** 35 hours

---

### 1.4 WebSocket Real-time Location Broadcasting

**Status:** CRITICAL - Polling instead of push

**Backend Tasks:**
- Implement WebSocket subscription manager
- Real-time rider location broadcast to order subscribers
- Order status change notifications
- Vendor new order alerts

**Architecture:**
```typescript
// WebSocket channels:
ws://server/subscribe/orders/:orderId     - Customer tracking
ws://server/subscribe/rider/:riderId      - Rider updates
ws://server/subscribe/vendor/:vendorId    - Vendor order alerts
ws://server/subscribe/admin/dispatch      - Admin console
```

**Frontend Tasks:**
- Convert polling to WebSocket in tracking components
- Add reconnection logic
- Real-time ETA updates

**Effort:** 40 hours

---

### 1.5 Commission & Payout APIs

**Status:** CRITICAL - Schema exists, no execution

**Backend Tasks:**
- Implement daily settlement calculation
- Create payout batch processing
- Endpoints:
  - `GET /api/vendor/settlements` - Vendor settlement history
  - `GET /api/vendor/payouts` - Payout history
  - `POST /api/admin/payouts/process` - Trigger batch payout
  - `GET /api/admin/financial/settlements` - All settlements

**Frontend Tasks:**
- Vendor earnings dashboard
- Payout history with status
- Admin settlement management

**Effort:** 35 hours

---

## Phase 2: High Priority Features (Weeks 3-4)

### 2.1 Customer App Enhancements

| Feature | Effort | Priority |
|---------|--------|----------|
| Address Management Page | 6 hours | HIGH |
| Favorites/Saved Restaurants | 4 hours | HIGH |
| Customer Profile Settings | 5 hours | HIGH |
| Tip Selection in Checkout | 2 hours | HIGH |
| Promo Code Input UI | 5 hours | HIGH |
| Review & Rating Form | 7 hours | HIGH |

**Key Components to Create:**
- `/customer/profile/addresses.tsx` - Address CRUD
- `/customer/profile/favorites.tsx` - Saved restaurants
- `/customer/profile/settings.tsx` - Preferences
- `/components/tip-selector.tsx` - Checkout tip UI
- `/components/promo-code-input.tsx` - Promo validation
- `/components/review-form.tsx` - Post-order review

---

### 2.2 Vendor Dashboard Enhancements

| Feature | Effort | Priority |
|---------|--------|----------|
| Business Hours Configuration | 4 hours | HIGH |
| Advanced Analytics Dashboard | 10 hours | HIGH |
| Commission Structure View | 6 hours | HIGH |
| Inventory Real-time Sync | 8 hours | MEDIUM |

**Key Components to Create:**
- `/vendor/business-settings.tsx` - Hours, holidays
- `/vendor/analytics.tsx` - Performance charts
- `/vendor/commission.tsx` - Commission breakdown

---

### 2.3 Rider App Enhancements

| Feature | Effort | Priority |
|---------|--------|----------|
| Order Acceptance Queue UI | 6 hours | HIGH |
| Daily Earnings Breakdown | 4 hours | HIGH |
| Performance Metrics Display | 6 hours | HIGH |
| Turn-by-Turn Navigation | 8 hours | MEDIUM |

**Key Components to Create:**
- `/rider/pending-orders.tsx` - Order queue with accept/reject
- `/rider/earnings.tsx` - Enhanced earnings breakdown
- `/rider/performance.tsx` - Metrics dashboard

---

### 2.4 Admin Panel Enhancements

| Feature | Effort | Priority |
|---------|--------|----------|
| Vendor Approval Workflow UI | 8 hours | HIGH |
| Rider Verification Dashboard | 8 hours | HIGH |
| Support Ticket System | 10 hours | HIGH |
| Commission Management UI | 6 hours | HIGH |
| Delivery Zone Map Editor | 8 hours | HIGH |

**Key Components to Create:**
- `/admin/vendor-approval.tsx` - Document review
- `/admin/rider-verification.tsx` - Checklist UI
- `/admin/support-tickets.tsx` - Ticket management
- `/admin/commission-settings.tsx` - Rate configuration
- `/admin/delivery-zones.tsx` - Map-based zone editor

---

### 2.5 Geofence & Address Features

**Backend Tasks:**
- Implement geofence auto-confirmation (pickup/delivery)
- Add Google Places API integration
- Create address validation service

**Frontend Tasks:**
- Address autocomplete component
- Delivery zone visualization
- Geofence arrival alerts

**Effort:** 44 hours total

---

## Phase 3: Revenue Optimization (Weeks 5-6)

### 3.1 Advanced Promo Code System

**Current:** Basic code validation
**Target:** Full promotional engine

**Features to Implement:**
- Percentage discounts with caps
- Fixed amount discounts with minimums
- Free delivery promotions
- First-order discounts
- Tiered discounts (spend more, save more)
- Vendor-funded vs platform-funded tracking
- Usage limits (global, per-user, per-day)
- Scheduling (date range, day of week, time of day)

**Endpoints:**
- `POST /api/admin/promos` - Create platform promo
- `POST /api/promos/validate` - Validate at checkout
- `GET /api/customer/promos/available` - List eligible promos

**Effort:** 25 hours

---

### 3.2 Loyalty Points System

**Current:** Schema complete, zero implementation

**Features to Implement:**
- Points earning (1 point per ₱10 spent)
- Points redemption (100 points = ₱10)
- Sign-up bonus (50 points)
- Tier system (Bronze/Silver/Gold multipliers)
- Points expiry (365 days)
- Transaction history

**Endpoints:**
- `GET /api/loyalty/points` - Balance
- `POST /api/loyalty/redeem` - Redeem points
- `GET /api/loyalty/history` - Transaction history

**Frontend:**
- `/customer/loyalty.tsx` - Points dashboard
- Checkout integration for redemption

**Effort:** 30 hours

---

### 3.3 Customer Wallet System

**Database Tables:**
```typescript
customer_wallets: { id, customer_id, balance, currency, last_updated }
wallet_transactions: { id, wallet_id, type, amount, reason, order_id, created_at }
```

**Features:**
- Wallet balance display
- Top-up via payment methods
- Auto-deduct before payment method
- Cashback/credit system
- Transaction history

**Effort:** 30 hours

---

## Phase 4: Operational Excellence (Weeks 7-8)

### 4.1 Tax Compliance Automation

**Features:**
- Automatic VAT calculation (12%)
- Withholding tax on vendor payments
- Monthly tax reports (BIR format)
- Tax exemption handling (senior citizen, PWD)

**Effort:** 20 hours

---

### 4.2 Financial Analytics Dashboard

**Admin Features:**
- Real-time revenue metrics
- Revenue by service type/region/time
- Vendor/rider performance rankings
- Profit margin analysis
- Export to Excel/PDF

**Effort:** 20 hours

---

### 4.3 Advanced Fraud Detection

**Enhancements:**
- Velocity checks (transactions per hour)
- Geolocation validation
- Device fingerprinting
- Historical pattern analysis
- ML model integration (future)

**Effort:** 24 hours

---

### 4.4 Enhanced Dispatch System

**Features:**
- Batch order assignment
- Manual dispatch override improvements
- SLA breach auto-escalation
- Emergency dispatch protocols
- Rider capacity planning

**Effort:** 20 hours

---

## Database Schema Additions Required

### New Tables

```sql
-- Vendor KYC
vendor_kyc_documents (id, vendor_id, doc_type, url, status, verified_at, verified_by)
vendor_bank_accounts (id, vendor_id, bank_name, account_number, is_verified, is_default)

-- Rider Verification
rider_documents (id, rider_id, doc_type, url, issue_date, expiry_date, status, verified_by)
rider_verification_status (rider_id, id_verified, license_verified, vehicle_verified, background_check)

-- Customer Features
customer_wallets (id, customer_id, balance, currency, last_updated)
wallet_transactions (id, wallet_id, type, amount, reason, order_id, created_at)
scheduled_orders (id, customer_id, restaurant_id, template, scheduled_for, frequency)

-- Referrals
referral_codes (id, user_id, code, discount_amount, usage_count, expiry_date)

-- Messaging
order_messages (id, order_id, sender_id, sender_role, message, sent_at, read_at)
```

### Schema Column Additions

```sql
-- orders table
ADD scheduled_order_id UUID
ADD is_group_order BOOLEAN
ADD cancellation_reason TEXT
ADD cancellation_initiated_by VARCHAR

-- restaurants table
ADD kyc_status VARCHAR
ADD kyc_verified_date TIMESTAMP
ADD default_bank_account_id UUID
ADD payout_frequency VARCHAR

-- users table
ADD wallet_balance DECIMAL
ADD referral_code VARCHAR
ADD referred_by_user_id UUID
```

---

## API Endpoints Summary

### Missing Critical Endpoints

**Vendor Management:**
```
POST   /api/vendor/register
POST   /api/vendor/kyc/upload-documents
POST   /api/vendor/kyc/verify-bank-account
GET    /api/vendor/settlements
GET    /api/vendor/payouts
GET    /api/vendor/earnings
```

**Rider Management:**
```
POST   /api/rider/documents/upload
GET    /api/rider/verification/status
GET    /api/rider/earnings
GET    /api/rider/performance
```

**Order Operations:**
```
POST   /api/orders/{id}/cancel
GET    /api/orders/{id}/refund-eligibility
POST   /api/orders/{id}/review
POST   /api/orders/{id}/dispute
```

**Customer Features:**
```
GET    /api/customer/addresses
POST   /api/customer/addresses
GET    /api/customer/favorites
POST   /api/customer/favorites/{restaurantId}
GET    /api/customer/wallet
POST   /api/customer/wallet/topup
GET    /api/loyalty/points
POST   /api/loyalty/redeem
```

**Admin Operations:**
```
POST   /api/admin/vendor/{id}/approve
POST   /api/admin/vendor/{id}/reject
POST   /api/admin/riders/{id}/verify-document
POST   /api/admin/payouts/process
GET    /api/admin/financial/settlements
POST   /api/admin/disputes/{id}/resolve
```

---

## Technology Stack Confirmation

### Current Stack (Validated)
- **Frontend:** React 18, Vite, TypeScript, Tailwind CSS, shadcn/ui
- **Backend:** Express.js, TypeScript, Drizzle ORM
- **Database:** PostgreSQL (Neon serverless)
- **Real-time:** WebSocket (ws library)
- **Payments:** NexusPay (GCash, Maya, Card)
- **Maps:** Google Maps API, Leaflet
- **AI:** Google Gemini
- **Notifications:** SendGrid (email), Twilio/Semaphore (SMS), Web Push

### Recommended Additions
- **Message Queue:** Consider Bull/BullMQ for background jobs
- **Caching:** Redis for session and real-time data
- **Search:** Elasticsearch/Meilisearch for restaurant discovery

---

## Implementation Timeline

```
Week 1-2: CRITICAL LAUNCH BLOCKERS
├── Vendor onboarding & KYC (40h)
├── Order refund workflow (30h)
├── Rider verification system (35h)
├── WebSocket location broadcasting (40h)
└── Commission & payout APIs (35h)
Total: 180 hours

Week 3-4: HIGH PRIORITY FEATURES
├── Customer app enhancements (29h)
├── Vendor dashboard enhancements (28h)
├── Rider app enhancements (24h)
├── Admin panel enhancements (40h)
└── Geofence & address features (44h)
Total: 165 hours

Week 5-6: REVENUE OPTIMIZATION
├── Advanced promo code system (25h)
├── Loyalty points system (30h)
└── Customer wallet system (30h)
Total: 85 hours

Week 7-8: OPERATIONAL EXCELLENCE
├── Tax compliance automation (20h)
├── Financial analytics dashboard (20h)
├── Advanced fraud detection (24h)
└── Enhanced dispatch system (20h)
Total: 84 hours

GRAND TOTAL: ~514 hours (13 developer-weeks)
```

---

## Team Allocation Recommendation

| Role | Focus Area | Weeks |
|------|------------|-------|
| Backend Engineer 1 | Payment, Commission, Refunds | 1-4 |
| Backend Engineer 2 | Onboarding, Verification, Real-time | 1-4 |
| Frontend Engineer 1 | Customer App, Checkout | 1-6 |
| Frontend Engineer 2 | Admin Panel, Dashboards | 1-6 |
| Full-stack Engineer | Vendor/Rider Features | 3-8 |

**Recommended Team Size:** 4-5 developers
**Timeline:** 8 weeks to production-ready

---

## Success Metrics

### Launch Readiness Criteria
- [ ] Vendors can self-register and get approved
- [ ] Riders can upload documents and get verified
- [ ] Orders can be cancelled with automatic refunds
- [ ] Real-time tracking works via WebSocket
- [ ] Vendors receive daily/weekly payouts
- [ ] Admin can manage disputes and settlements
- [ ] Basic analytics dashboard functional

### Post-Launch KPIs
- Vendor onboarding completion rate > 80%
- Order cancellation rate < 5%
- Payment success rate > 95%
- Average delivery time < 35 minutes
- Customer satisfaction score > 4.5/5
- Rider verification completion < 48 hours

---

## Risk Mitigation

### High-Risk Items
1. **Payment Gateway Reliability** - Implement fallback to COD
2. **Real-time Performance** - Load test WebSocket with 1000+ concurrent users
3. **Fraud Prevention** - Monitor chargeback rates, implement velocity limits
4. **Regulatory Compliance** - Tax filing, data privacy (GDPR-like)

### Contingency Plans
- Manual payout processing if automation fails
- SMS fallback if push notifications fail
- Admin override for all automated decisions
- 24/7 on-call for critical payment issues

---

## Conclusion

The BTS Delivery app has built an **impressive enterprise-grade foundation** that rivals commercial platforms. The database schema is particularly sophisticated with 66+ tables covering advanced scenarios like SLA tracking, fraud detection, and tiered commissions.

**To reach production parity with Enatega/Talabat:**
1. Complete Phase 1 (critical blockers) in 2 weeks
2. Implement Phase 2 (high priority) in 2 weeks
3. Add revenue features in Phase 3
4. Polish operations in Phase 4

**Total estimated effort: 8 weeks with 4-5 developers**

The platform is well-positioned to become a competitive multi-vendor delivery solution for Batangas Province and beyond.
